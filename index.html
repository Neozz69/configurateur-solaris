<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurateur Solaris Store - Comparateur</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary: #f39c12; 
            --secondary: #2c3e50; 
            --accent: #27ae60;
            --light: #ecf0f1;
            --danger: #e74c3c;
            --text: #34495e;
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; margin: 0; padding: 0; color: var(--text); }
        
        header { background-color: white; padding: 15px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.05); text-align: center; }
        header h1 { color: var(--secondary); margin: 10px 0 0 0; font-size: 1.8rem; }
        header p { color: #7f8c8d; margin: 5px 0 0 0; }

        .container { max-width: 1200px; margin: 30px auto; padding: 20px; }
        
        /* Layout Grid */
        .layout-grid { display: grid; grid-template-columns: 1fr; gap: 30px; }
        
        /* Section Styles */
        .section-card { background: white; border-radius: 12px; padding: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.03); }
        h2 { color: var(--secondary); border-left: 5px solid var(--primary); padding-left: 15px; margin-top: 0; }

        /* Form Styling */
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--secondary); }
        select, input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; transition: 0.3s; box-sizing: border-box;}
        select:focus, input:focus { border-color: var(--primary); outline: none; }

        /* Table */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { background: #f8f9fa; text-align: left; padding: 15px; color: var(--secondary); font-weight: 600; }
        td { padding: 15px; border-bottom: 1px solid #eee; }
        .btn-remove { background: #ffebee; color: var(--danger); border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-remove:hover { background: var(--danger); color: white; }

        /* Action Buttons */
        .btn-add { background: var(--secondary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; }
        .btn-calc { background: var(--primary); color: white; border: none; padding: 15px 30px; border-radius: 8px; font-size: 1.2rem; font-weight: bold; cursor: pointer; width: 100%; margin-top: 20px; transition: transform 0.2s; }
        .btn-calc:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4); }

        /* Comparison Results */
        #results-area { display: none; margin-top: 40px; }
        .kits-container { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        @media (max-width: 800px) { .kits-container { grid-template-columns: 1fr; } }

        .kit-card { background: white; border-radius: 12px; overflow: hidden; border: 1px solid #eee; transition: 0.3s; position: relative; display: flex; flex-direction: column; }
        .kit-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-color: var(--primary); }
        
        .kit-header { padding: 20px; color: white; text-align: center; }
        .kit-eco .kit-header { background: linear-gradient(135deg, #95a5a6, #7f8c8d); }
        .kit-pro .kit-header { background: linear-gradient(135deg, #f39c12, #d35400); }
        
        .kit-body { padding: 25px; flex-grow: 1; }
        .kit-price { font-size: 1.8rem; font-weight: bold; color: var(--secondary); text-align: center; margin: 15px 0; }
        .kit-details ul { padding-left: 20px; color: #555; }
        .kit-details li { margin-bottom: 8px; }
        
        .kit-footer { padding: 20px; text-align: center; background: #f9f9f9; border-top: 1px solid #eee; }
        .btn-select { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; font-size: 1rem; }
        .kit-eco .btn-select { background: #95a5a6; color: white; }
        .kit-pro .btn-select { background: var(--primary); color: white; }

        /* AI Chatbot Advanced */
        #chatbot { position: fixed; bottom: 30px; right: 30px; width: 350px; height: 50px; background: white; border-radius: 25px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); overflow: hidden; z-index: 1000; border: 1px solid #eee; display: flex; flex-direction: column; }
        #chatbot.open { height: 500px; border-radius: 15px; }
        
        .chat-header { background: var(--secondary); color: white; padding: 15px 20px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-weight: bold; }
        .chat-status { width: 10px; height: 10px; background: #2ecc71; border-radius: 50%; display: inline-block; animation: pulse 2s infinite; }
        
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; background: #f4f7f6; display: flex; flex-direction: column; gap: 10px; }
        .chat-input { padding: 15px; background: white; border-top: 1px solid #eee; display: flex; gap: 10px; }
        .chat-input input { border-radius: 20px; padding: 10px 15px; font-size: 0.9rem; }
        
        .msg { padding: 10px 15px; border-radius: 15px; max-width: 85%; font-size: 0.9rem; line-height: 1.4; animation: popIn 0.3s ease; }
        .msg.bot { background: white; color: #333; border-bottom-left-radius: 2px; border: 1px solid #eee; }
        .msg.user { background: var(--primary); color: white; align-self: flex-end; border-bottom-right-radius: 2px; }
        .msg.system { background: #e8f6f3; color: #16a085; font-size: 0.8rem; text-align: center; align-self: center; border: 1px dashed #1abc9c; width: 90%; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        @keyframes popIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<header>
    <h1><i class="fas fa-solar-panel" style="color:var(--primary);"></i> Solaris Store</h1>
    <p>Configurateur Site Isol√© & Hybride</p>
</header>

<div class="container">
    
    <div class="section-card">
        <h2><i class="fas fa-map-marker-alt"></i> 1. Localisation</h2>
        <div class="input-group">
            <label>S√©lectionnez votre zone :</label>
            <select id="zone">
                <option value="0.85">Nord / Belgique (Faible)</option>
                <option value="1.0" selected>Centre / Ouest (Moyen)</option>
                <option value="1.3">Sud de la France (Fort)</option>
                <option value="1.5">Afrique / DOM-TOM (Tr√®s fort)</option>
            </select>
        </div>
        <div class="input-group">
            <label>Autonomie souhait√©e :</label>
            <select id="autonomy">
                <option value="1">1 jour (Usage Weekend)</option>
                <option value="2" selected>2 jours (Standard Habitat)</option>
                <option value="3">3 jours (S√©curit√© Maximale)</option>
            </select>
        </div>
    </div>

    <div class="section-card" style="margin-top: 20px;">
        <h2><i class="fas fa-plug"></i> 2. Vos Appareils</h2>
        
        <div style="background: #fdf2e9; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary); margin-bottom: 20px;">
            <i class="fas fa-info-circle"></i> <strong>Astuce :</strong> Ajoutez vos appareils un par un. L'assistant IA analyse votre liste en temps r√©el.
        </div>

        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <select id="preset-select">
                <option value="">-- Appareils Rapides --</option>
                <option value='{"name":"Frigo A++", "w":40, "h":24, "cat":"motor"}'>R√©frig√©rateur (24h)</option>
                <option value='{"name":"√âclairage LED", "w":50, "h":5, "cat":"resistive"}'>Lumi√®res (5h)</option>
                <option value='{"name":"TV LED", "w":80, "h":4, "cat":"electronic"}'>T√©l√©vision (4h)</option>
                <option value='{"name":"Pompe √† eau", "w":1000, "h":0.5, "cat":"motor"}'>Pompe √† eau (30 min)</option>
                <option value='{"name":"Machine Caf√©", "w":1400, "h":0.1, "cat":"heating"}'>Cafeti√®re (Express)</option>
                <option value='{"name":"Lave Linge", "w":2000, "h":0.5, "cat":"motor"}'>Lave-linge (Cycle Eco)</option>
                <option value='{"name":"Ordinateur", "w":60, "h":6, "cat":"electronic"}'>PC Portable (6h)</option>
            </select>
            <button onclick="addPreset()" class="btn-add">Ajouter</button>
        </div>

        <table id="appliance-table">
            <thead>
                <tr>
                    <th>Appareil</th>
                    <th width="120">Puissance (W)</th>
                    <th width="120">Heures/jour</th>
                    <th width="50"></th>
                </tr>
            </thead>
            <tbody id="appliance-list"></tbody>
        </table>

        <div style="text-align: right; margin-top: 15px; font-size: 1.1rem;">
            Total: <strong><span id="total-wh">0</span> Wh/jour</strong> | Cr√™te: <strong><span id="peak-w">0</span> W</strong>
        </div>

        <button onclick="calculateKits()" class="btn-calc">COMPARER LES KITS SOLAIRES</button>
    </div>

    <div id="results-area">
        <h2 style="text-align: center; border: none;">üí° Nos Recommandations</h2>
        
        <div class="kits-container">
            
            <div class="kit-card kit-eco">
                <div class="kit-header">
                    <h3>OPTION BUDGET</h3>
                    <span>Technologie Plomb Gel</span>
                </div>
                <div class="kit-body">
                    <p>Id√©al pour r√©sidence secondaire ou budget ma√Ætris√©.</p>
                    <div class="kit-price" id="price-lead">-- ‚Ç¨</div>
                    <div class="kit-details" id="details-lead"></div>
                </div>
                <div class="kit-footer">
                    <button class="btn-select" onclick="openDetails('lead')">Voir ce kit</button>
                </div>
            </div>

            <div class="kit-card kit-pro">
                <div style="position: absolute; top: 15px; right: -30px; background: #c0392b; color: white; padding: 5px 40px; transform: rotate(45deg); font-weight: bold; font-size: 0.8rem;">BEST SELLER</div>
                <div class="kit-header">
                    <h3>OPTION PERFORMANCE</h3>
                    <span>Technologie Lithium LiFePO4</span>
                </div>
                <div class="kit-body">
                    <p>Dur√©e de vie x5, charge rapide, extension facile.</p>
                    <div class="kit-price" id="price-lithium">-- ‚Ç¨</div>
                    <div class="kit-details" id="details-lithium"></div>
                </div>
                <div class="kit-footer">
                    <button class="btn-select" onclick="openDetails('lithium')">Voir ce kit</button>
                </div>
            </div>

        </div>
    </div>

</div>

<div id="chatbot" class="closed">
    <div class="chat-header" onclick="toggleChat()">
        <span class="chat-status"></span>
        <span>Assistant Solaris IA</span>
    </div>
    <div class="chat-body" id="chat-body">
        <div class="msg bot">Bonjour ! Je suis l'IA Solaris. Je surveille votre configuration en temps r√©el pour optimiser le dimensionnement. Ajoutez des appareils pour commencer.</div>
    </div>
    <div class="chat-input">
        <input type="text" id="chat-input" placeholder="Posez une question..." onkeypress="handleEnter(event)">
        <button onclick="sendMessage()" style="border:none; background:var(--primary); color:white; border-radius:50%; width:35px; height:35px; cursor:pointer;"><i class="fas fa-paper-plane"></i></button>
    </div>
</div>

<script>
    // --- PRIX UNITAIRES (A REMPLIR PAR TOI) ---
    const PRICES = {
        panel: 160,          // JA Solar 460W
        bat_lead: 280,       // Ultracell 150Ah
        bat_lithium: 1650,   // Pylontech US5000
        multi_3000: 1100,
        multi_5000: 1900,
        multi_8000: 3500,
        mppt_small: 150,
        mppt_med: 400,
        mppt_large: 700,
        cerbo_kit: 450,      // Cerbo + Touch
        fixation_base: 200,
        cables_base: 150
    };

    // Specs Techniques
    const SPECS = {
        panel_w: 460,
        lead_dod_daily: 0.3, // 30% max par jour
        lead_dod_max: 0.7,   // 70% max total
        lit_dod: 0.85        // 85% utilisable
    };

    // --- LOGIQUE METIER ---

    function calculateKits() {
        const zone = parseFloat(document.getElementById('zone').value);
        const autonomy = parseInt(document.getElementById('autonomy').value);
        const { totalWh, peakW } = getConsumption();

        if(totalWh === 0) {
            aiAlert("Je ne peux pas calculer un kit vide. Ajoutez des appareils !");
            return;
        }

        // 1. Panneaux (Commun aux deux)
        // Besoin / (HSE Hiver * Zone * 0.75 rendement)
        const productionFactor = 3.0 * zone * 0.75;
        const panelsNeeded = Math.ceil(totalWh / productionFactor / SPECS.panel_w);
        const totalWc = panelsNeeded * SPECS.panel_w;

        // Choix MPPT
        let mpptPrice = PRICES.mppt_small;
        let mpptName = "MPPT 150/35";
        if(totalWc > 1500) { mpptPrice = PRICES.mppt_med; mpptName = "MPPT 250/60"; }
        if(totalWc > 3000) { mpptPrice = PRICES.mppt_large; mpptName = "MPPT 250/100"; }

        // Choix Onduleur
        let inverterPrice = PRICES.multi_3000;
        let inverterName = "MultiPlus-II 3000VA";
        if(peakW * 1.2 > 2400) { inverterPrice = PRICES.multi_5000; inverterName = "MultiPlus-II 5000VA"; }
        if(peakW * 1.2 > 4000) { inverterPrice = PRICES.multi_8000; inverterName = "MultiPlus-II 8000VA"; }

        // --- OPTION 1 : PLOMB (ECO) ---
        // Dimensionnement par contrainte cycle journalier (le plus strict)
        const leadWhNeeded = Math.max(
            (totalWh * autonomy) / SPECS.lead_dod_max, // Autonomie
            totalWh / SPECS.lead_dod_daily             // Cycle de vie
        );
        const leadUnitWh = 12 * 150; // 1800Wh
        let leadQty = Math.ceil(leadWhNeeded / leadUnitWh);
        // Force multiple de 4 pour 48V
        if(leadQty < 4) leadQty = 4;
        else if (leadQty % 4 !== 0) leadQty += (4 - (leadQty % 4));

        const priceLead = (panelsNeeded * PRICES.panel) + (leadQty * PRICES.bat_lead) + inverterPrice + mpptPrice + PRICES.cerbo_kit + PRICES.fixation_base + PRICES.cables_base;

        // Rendu HTML Plomb
        document.getElementById('price-lead').innerText = priceLead.toLocaleString() + " ‚Ç¨";
        document.getElementById('details-lead').innerHTML = `
            <ul>
                <li><strong>${panelsNeeded}x Panneaux</strong> JA Solar (${totalWc}Wc)</li>
                <li><strong>${leadQty}x Batteries</strong> Gel 150Ah (Parc ${(leadQty*12*150)/1000} kWh)</li>
                <li><strong>1x Onduleur</strong> ${inverterName}</li>
                <li><strong>1x R√©gulateur</strong> ${mpptName}</li>
                <li>Supervision Cerbo GX incluse</li>
            </ul>
        `;

        // --- OPTION 2 : LITHIUM (PREMIUM) ---
        const litWhNeeded = (totalWh * autonomy) / SPECS.lit_dod;
        const litUnitWh = 4800; // US5000
        let litQty = Math.ceil(litWhNeeded / litUnitWh);
        if(litQty < 1) litQty = 1;

        const priceLit = (panelsNeeded * PRICES.panel) + (litQty * PRICES.bat_lithium) + inverterPrice + mpptPrice + PRICES.cerbo_kit + PRICES.fixation_base + PRICES.cables_base;

        // Rendu HTML Lithium
        document.getElementById('price-lithium').innerText = priceLit.toLocaleString() + " ‚Ç¨";
        document.getElementById('details-lithium').innerHTML = `
            <ul>
                <li><strong>${panelsNeeded}x Panneaux</strong> JA Solar (${totalWc}Wc)</li>
                <li><strong>${litQty}x Pylontech</strong> US5000 (${(litQty*4.8).toFixed(1)} kWh)</li>
                <li><strong>1x Onduleur</strong> ${inverterName}</li>
                <li><strong>1x R√©gulateur</strong> ${mpptName}</li>
                <li>Supervision Cerbo GX incluse</li>
            </ul>
        `;

        // Afficher la zone
        document.getElementById('results-area').style.display = 'block';
        document.getElementById('results-area').scrollIntoView({behavior: 'smooth'});

        // AI Comment
        aiMessage(`Calcul termin√© ! Je vous recommande le <strong>Kit Lithium</strong> sur le long terme (10+ ans). Le kit Plomb est viable si vous respectez strictement les 30% de d√©charge.`);
    }

    function openDetails(type) {
        alert("Ici, on redirigera vers la page produit du kit " + type + " ou on ajoutera au panier.");
    }

    // --- GESTION TABLEAU ---
    function addPreset() {
        const val = document.getElementById('preset-select').value;
        if(!val) return;
        const obj = JSON.parse(val);
        
        // AI Analysis immediate
        if(obj.cat === 'motor') aiMessage(`J'ai d√©tect√© un appareil inductif (${obj.name}). Je vais pr√©voir une marge pour l'onduleur.`);
        if(obj.cat === 'heating') aiMessage(`Attention, ${obj.name} est tr√®s √©nergivore. V√©rifiez bien le temps d'utilisation.`);

        const tbody = document.getElementById('appliance-list');
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${obj.name}</td>
            <td><input type="number" value="${obj.w}" class="p-watt" onchange="updateLiveStats()"></td>
            <td><input type="number" value="${obj.h}" class="p-hour" onchange="updateLiveStats()"></td>
            <td><button class="btn-remove" onclick="this.closest('tr').remove(); updateLiveStats()">X</button></td>
        `;
        tbody.appendChild(row);
        updateLiveStats();
    }

    function getConsumption() {
        let totalWh = 0;
        let peakW = 0;
        document.querySelectorAll('#appliance-list tr').forEach(r => {
            const w = parseFloat(r.querySelector('.p-watt').value) || 0;
            const h = parseFloat(r.querySelector('.p-hour').value) || 0;
            totalWh += w * h;
            peakW += w;
        });
        return { totalWh, peakW };
    }

    function updateLiveStats() {
        const { totalWh, peakW } = getConsumption();
        document.getElementById('total-wh').innerText = Math.round(totalWh);
        document.getElementById('peak-w').innerText = Math.round(peakW);
    }

    // --- AI LOGIC (LOCAL) ---
    function toggleChat() {
        document.getElementById('chatbot').classList.toggle('open');
    }

    function sendMessage() {
        const input = document.getElementById('chat-input');
        const txt = input.value;
        if(!txt) return;
        
        // User msg
        const d = document.createElement('div');
        d.className = 'msg user'; d.innerText = txt;
        document.getElementById('chat-body').appendChild(d);
        input.value = '';

        // Bot thinking
        setTimeout(() => {
            let reply = "Je peux vous aider sur le choix entre Plomb et Lithium.";
            const low = txt.toLowerCase();
            
            if(low.includes('diff√©rence') || low.includes('comparer')) {
                reply = "Le Lithium co√ªte plus cher √† l'achat mais dure 6000 cycles (15 ans) contre 600 cycles (4 ans) pour le Plomb si mal utilis√©. Le Lithium est le vrai choix √©conomique sur la dur√©e.";
            } else if(low.includes('pompe') || low.includes('moteur')) {
                reply = "Pour les pompes, l'onduleur MultiPlus est excellent car il encaisse des pics de puissance 2x sup√©rieurs √† sa valeur nominale.";
            } else if(low.includes('prix') || low.includes('co√ªt')) {
                reply = "Les prix affich√©s incluent tout le n√©cessaire : c√¢bles, fusibles, fixations toiture. C'est du pr√™t-√†-monter.";
            }

            aiMessage(reply);
        }, 800);
    }

    function aiMessage(html) {
        const c = document.getElementById('chat-body');
        const d = document.createElement('div');
        d.className = 'msg bot';
        d.innerHTML = html;
        c.appendChild(d);
        c.scrollTop = c.scrollHeight;
        
        // Auto open if closed
        if(!document.getElementById('chatbot').classList.contains('open')) {
           // Optional: small notification badge logic here
        }
    }

    function aiAlert(text) {
        const c = document.getElementById('chat-body');
        const d = document.createElement('div');
        d.className = 'msg system';
        d.innerHTML = '<i class="fas fa-exclamation-triangle"></i> ' + text;
        c.appendChild(d);
        toggleChat(); // Force open
    }
    
    // Init
    updateLiveStats();
</script>

</body>
</html>
